version: 0.3

relativeLayouts {
    #effectButtons sequence($i: 0..8) point: 50 + ($i % 5) * 200, 55 + 30* $i div 5
}

// Advanced Particle System Examples
// Demonstrates all particle features including:
// - Emit modes: point, cone, box, circle, path
// - Color interpolation with start/mid/end colors
// - Force fields: attractor, repulsor, vortex, wind, turbulence
// - Velocity and size curves over lifetime
// - Bounds modes: kill, bounce, wrap
// - Rotation options
// - Animation and multi-tile support

// =============================================================================
// FIRE EFFECT - Upward flames with color gradient and size curve
// =============================================================================
#fire particles {
    count: 100
    emit: cone(0, 10, -90, 30)
    maxLife: 2.0
    lifeRandom: 0.3
    speed: 80
    speedRandom: 0.3
    tiles: file("circle_soft.png")
    loop: true
    size: 0.8
    sizeRandom: 0.4
    emitSync: 0.2
    blendMode: add
    fadeIn: 0.1
    fadeOut: 0.6
    fadePower: 1.5

    // Color gradient: orange -> yellow -> white
    colorStart: #FF4400
    colorMid: #FFAA00
    colorMidPos: 0.4
    colorEnd: #FFFF88

    // Size grows then shrinks
    sizeCurve: [(0, 0.5), (0.3, 1.2), (1.0, 0.2)]

    // Slight turbulence for flickering
    forceFields: [turbulence(30, 0.02, 2.0)]
}

// =============================================================================
// SMOKE EFFECT - Rising smoke with turbulence and fade
// =============================================================================
#smoke particles {
    count: 80
    emit: box(60, 10, -90, 25)
    maxLife: 4.0
    lifeRandom: 0.5
    speed: 25
    speedRandom: 0.3
    speedIncrease: -0.3
    tiles: file("smoke.png")
    loop: true
    size: 0.4
    sizeRandom: 0.2
    emitSync: 0.3
    blendMode: alpha
    fadeIn: 0.2
    fadeOut: 0.5
    fadePower: 2.0

    // Gray to transparent
    colorStart: #888888
    colorEnd: #444444

    // Size increases over lifetime
    sizeCurve: [(0, 0.3), (0.5, 1.0), (1.0, 1.8)]

    // Turbulence and slight wind
    forceFields: [turbulence(20, 0.015, 1.0), wind(15, 0)]

    // Rotation
    rotationInitial: 180
    rotationSpeed: 20
    rotationSpeedRandom: 40
}

// =============================================================================
// SPARKLES - Falling stars with gravity and bounce
// =============================================================================
#sparkles particles {
    count: 60
    emit: box(200, 10, 0, 180)
    maxLife: 3.0
    lifeRandom: 0.5
    speed: 120
    speedRandom: 0.5
    tiles: file("star.png")
    loop: true
    size: 0.4
    sizeRandom: 0.3
    emitSync: 0.1
    blendMode: add
    fadeIn: 0.05
    fadeOut: 0.7
    fadePower: 1.0

    // Gravity pulling down
    gravity: 150
    gravityAngle: 90

    // Color: white -> gold -> dim
    colorStart: #FFFFFF
    colorMid: #FFDD44
    colorMidPos: 0.5
    colorEnd: #886622

    // Bounce off bottom
    boundsMode: bounce(0.6)
    boundsMinX: -100
    boundsMaxX: 300
    boundsMinY: -50
    boundsMaxY: 250

    // Spin as they fall
    rotationSpeed: 180
    rotationSpeedRandom: 360
}

// =============================================================================
// VORTEX EFFECT - Swirling particles with attractor
// =============================================================================
#vortex particles {
    count: 150
    emit: circle(150, 50, 0, 0)
    maxLife: 4.0
    lifeRandom: 0.3
    speed: 30
    speedRandom: 0.5
    tiles: file("dot.png")
    loop: true
    size: 0.3
    sizeRandom: 0.2
    emitSync: 0.1
    blendMode: add
    fadeIn: 0.1
    fadeOut: 0.8

    // Cyan to purple gradient
    colorStart: #00FFFF
    colorMid: #FF00FF
    colorMidPos: 0.6
    colorEnd: #4400AA

    // Vortex force field at center + attractor
    forceFields: [vortex(0, 0, 200, 200), attractor(0, 0, 50, 180)]

    // Speed increases as particles spiral in
    velocityCurve: [(0, 0.5), (0.5, 1.0), (1.0, 2.0)]
}

// =============================================================================
// EXPLOSION - Burst with velocity decay
// =============================================================================
#explosion particles {
    count: 80
    emit: point(0, 20)
    maxLife: 1.2
    lifeRandom: 0.3
    speed: 300
    speedRandom: 0.5
    speedIncrease: -0.8
    tiles: file("flare.png") file("spark.png")
    loop: true
    size: 0.8
    sizeRandom: 0.4
    emitSync: 0.95
    emitDelay: 0.0
    blendMode: add
    fadeIn: 0.0
    fadeOut: 0.5
    fadePower: 1.0

    // White -> orange -> red
    colorStart: #FFFFFF
    colorMid: #FF8800
    colorMidPos: 0.3
    colorEnd: #FF2200

    // Velocity decays quickly
    velocityCurve: [(0, 1.0), (0.2, 0.5), (1.0, 0.1)]

    // Size shrinks
    sizeCurve: [(0, 1.0), (0.5, 0.6), (1.0, 0.1)]

    // Direction-based rotation
    rotateAuto: true

    // Random tile animation
    animationRepeat: 0
}

// =============================================================================
// RAIN - Falling streaks with wrap bounds
// =============================================================================
#rain particles {
    count: 200
    emit: box(500, 10, 100, 5)
    maxLife: 1.5
    lifeRandom: 0.2
    speed: 400
    speedRandom: 0.15
    tiles: file("spark.png")
    loop: true
    size: 0.2
    sizeRandom: 0.1
    emitSync: 0.0
    blendMode: alpha
    fadeIn: 0.1
    fadeOut: 0.9

    // Blue-ish rain
    colorStart: #AACCFF
    colorEnd: #6688CC

    // Gravity adds to downward motion
    gravity: 100
    gravityAngle: 90

    // Wrap around when hitting bounds
    boundsMode: wrap
    boundsMinX: -50
    boundsMaxX: 450
    boundsMinY: -20
    boundsMaxY: 350

    // Stretch in direction of motion
    rotateAuto: true
}

// =============================================================================
// MAGIC TRAIL - Path emitter with color pulse
// =============================================================================
#magicTrail particles {
    count: 60
    emit: circle(30, 20, 0, 0)
    maxLife: 2.5
    lifeRandom: 0.3
    speed: 40
    speedRandom: 0.4
    tiles: file("comet.png") file("glow.png")
    loop: true
    size: 0.5
    sizeRandom: 0.3
    emitSync: 0.15
    blendMode: add
    fadeIn: 0.1
    fadeOut: 0.6
    fadePower: 1.2

    // Magical purple/cyan colors
    colorStart: #AA44FF
    colorMid: #44FFFF
    colorMidPos: 0.5
    colorEnd: #FF44AA

    // Pulsing size
    sizeCurve: [(0, 0.5), (0.25, 1.2), (0.5, 0.8), (0.75, 1.1), (1.0, 0.3)]

    // Gentle turbulence
    forceFields: [turbulence(25, 0.025, 1.5)]

    // Slow rotation
    rotationSpeed: 30
    rotationSpeedRandom: 60
}

// =============================================================================
// CONFETTI - Animated falling pieces with wind and bounce
// =============================================================================
#confetti particles {
    count: 100
    emit: box(400, 0, 90, 50)
    maxLife: 6.0
    lifeRandom: 1.0
    speed: 40
    speedRandom: 0.6
    tiles: file("star.png") file("ring.png") file("dot.png")
    loop: true
    size: 0.4
    sizeRandom: 0.3
    emitSync: 0.05
    blendMode: alpha
    fadeIn: 0.0
    fadeOut: 0.85
    fadePower: 1.0

    // Gravity
    gravity: 80
    gravityAngle: 90

    // Spin wildly
    rotationSpeed: 120
    rotationSpeedRandom: 240

    // Cycle through tiles
    animationRepeat: 5

    // Bright party colors
    colorStart: #FF66CC
    colorMid: #66FF66
    colorMidPos: 0.5
    colorEnd: #6666FF

    // Wind and turbulence for flutter
    forceFields: [wind(30, 0), turbulence(20, 0.015, 0.5)]

    // Bounce at bottom
    boundsMode: bounce(0.5)
    boundsMinX: -50
    boundsMaxX: 450
    boundsMinY: -50
    boundsMaxY: 350
}

// =============================================================================
// PLASMA - Soft pulsing energy with repulsor
// =============================================================================
#plasma particles {
    count: 120
    emit: point(0, 80)
    maxLife: 3.0
    lifeRandom: 0.4
    speed: 60
    speedRandom: 0.5
    tiles: file("electric-small.png") file("circle_soft.png")
    loop: true
    size: 0.6
    sizeRandom: 0.4
    emitSync: 0.1
    blendMode: add
    fadeIn: 0.15
    fadeOut: 0.5
    fadePower: 1.5

    // Electric blue to pink
    colorStart: #0088FF
    colorMid: #FF00FF
    colorMidPos: 0.5
    colorEnd: #FF4488

    // Repulsor pushes particles outward, then they slow
    forceFields: [repulsor(0, 0, 100, 120), turbulence(15, 0.02, 2.0)]

    // Velocity curve: fast start, slow end
    velocityCurve: [(0, 1.5), (0.3, 1.0), (1.0, 0.3)]

    // Size pulses
    sizeCurve: [(0, 0.3), (0.2, 1.0), (0.5, 0.7), (0.8, 1.1), (1.0, 0.4)]
}

// =============================================================================
// UI DEMONSTRATION
// =============================================================================
#ui programmable() {
    text(pixellari, "Particles Demo", #ffffff, left, 800): 5, 5

    // Effect buttons row using relative layout
    placeholder(generated(cross(75, 25)), builderParameter("fireBtn")): layout(effectButtons, 0)
    placeholder(generated(cross(75, 25)), builderParameter("smokeBtn")): layout(effectButtons, 1)
    placeholder(generated(cross(75, 25)), builderParameter("sparklesBtn")): layout(effectButtons, 2)
    placeholder(generated(cross(75, 25)), builderParameter("vortexBtn")): layout(effectButtons, 3)
    placeholder(generated(cross(75, 25)), builderParameter("explosionBtn")): layout(effectButtons, 4)
    placeholder(generated(cross(75, 25)), builderParameter("rainBtn")): layout(effectButtons, 5)
    placeholder(generated(cross(75, 25)), builderParameter("magicTrailBtn")): layout(effectButtons, 6)
    placeholder(generated(cross(75, 25)), builderParameter("confettiBtn")): layout(effectButtons, 7)
    placeholder(generated(cross(75, 25)), builderParameter("plasmaBtn")): layout(effectButtons, 8)

    #effectName(updatable) text(pixellari, "fire", #ffff00, left, 800): 5, 25

    #particles1(updatable) point: 400, 380
}
