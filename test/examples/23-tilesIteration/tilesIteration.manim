version: 0.3

#tilesIteration programmable() {
  pos: 0, 0
  grid: 1280, 720

  @alpha(0.3) bitmap(generated(color(1280, 720, gray)));

  // Test stateanim iterator - iterate over animation frames from marine.anim
  // Shows each frame as a bitmap with its index
  text(dd, "stateanim iterator (marine.anim idle frames):", yellow, left, 600):40,60;
  repeatable($index, stateanim($bitmap, "marine.anim", "idle", direction=>r)) {
    bitmap($bitmap): 40 + $index * 140, 100;
    text(dd, "frame "+$index, yellow, left, 100): 40 + $index * 140, 180;
  }

  // Test tiles iterator with tilename - iterate over all tiles in crew2 sheet
  // Exposes $bitmap, $tilename, and $index
  text(dd, "tiles iterator with tilename (crew2 sheet):", yellow, left, 600): 40, 240;
  @scale(0.5) point {
    pos: 40, 270
    repeatable($index, tiles($bitmap, $tilename, "crew2")) {
      bitmap($bitmap): ($index % 24) * 70, ($index div 24) * 50;
    }
  }

  // Test tiles iterator with tile name filter - iterate over all frames of a specific tile
  // Uses sheet name and exact tile name (key) to filter specific tiles
  text(dd, "tiles with tile filter (Arrow_dir0):", yellow, left, 600): 40, 480;
  @scale(0.5) point {
    pos: 40, 510
    repeatable($index, tiles($bitmap, "crew2", "Arrow_dir0")) {
      bitmap($bitmap): ($index % 24) * 70, ($index div 24) * 50;
    }
  }
}

#main point {
  pos: 0, 0
  reference($tilesIteration):0,0
}
