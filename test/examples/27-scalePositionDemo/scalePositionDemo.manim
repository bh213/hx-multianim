version: 0.5

// =============================================================================
// SCALE POSITION DEMO - Verify that scale does NOT affect position
// =============================================================================
// This test proves that @scale(N) only scales the element itself,
// NOT its position. The element's origin stays at the specified coordinates.
// =============================================================================

#scalePositionDemo programmable() {
    pos: 0, 0
    grid: 1280, 720

    // Dark background
    bitmap(generated(color(1280, 720, #333)));

    // =========================================================================
    // TEST 1: Scaled element vs absolute position element
    // Both should have their TOP-LEFT at the same position
    // =========================================================================

    point {
        pos: 0, 0

        // Reference crosshair at (100, 100) - where both elements should start
        graphics(
            line(#FF0, 2, 100, 50, 100, 150);   // vertical line
            line(#FF0, 2, 50, 100, 150, 100);   // horizontal line
        );

        // RED box: scale 3, position (100, 100)
        // If scale affected position, it would be at (300, 300)
        // But it should be at (100, 100) - just 3x bigger
        @scale(3) bitmap(generated(color(20, 20, #F00))):100,100;

        // GREEN box: NO scale, position (100, 100)
        // This proves the red box origin is at (100, 100)
        bitmap(generated(color(20, 20, #0F0))):100,100;

        // Label
        text(m3x6, "TEST 1: Red (scale 3) and Green (no scale) at pos 100,100", white, left, 600):100,180;
        text(m3x6, "Both should start at same point (100,100) - green overlaps red's corner", #AAA, left, 600):100,195;
    }

    // =========================================================================
    // TEST 2: Side by side comparison with markers
    // =========================================================================

    // Left side: scaled element
    point {
        pos: 100, 280

        // Crosshair at origin
        graphics(
            line(#FF0, 1, 0, -10, 0, 60);
            line(#FF0, 1, -10, 0, 80, 0);
        );

        // Blue box at (50, 30) with scale 2
        @scale(2) bitmap(generated(color(15, 15, #00F))):50,30;

        // White marker exactly at (50, 30)
        bitmap(generated(color(4, 4, white))):48,28;

        text(m3x6, "scale(2) at 50,30", #0FF, left, 200):0,70;
        text(m3x6, "White dot at 50,30", #888, left, 200):0,85;
    }

    // Right side: unscaled but manually sized to match
    point {
        pos: 300, 280

        // Crosshair at origin
        graphics(
            line(#FF0, 1, 0, -10, 0, 60);
            line(#FF0, 1, -10, 0, 80, 0);
        );

        // Blue box at (50, 30) - 30x30 (same visual size as 15x15 @ scale 2)
        bitmap(generated(color(30, 30, #00F))):50,30;

        // White marker exactly at (50, 30)
        bitmap(generated(color(4, 4, white))):48,28;

        text(m3x6, "no scale, 30x30 at 50,30", #0FF, left, 200):0,70;
        text(m3x6, "White dot at 50,30", #888, left, 200):0,85;
    }

    text(m3x6, "TEST 2: Both boxes start at same relative position (50,30)", white, left, 600):100,400;

    // =========================================================================
    // TEST 3: Where would it be IF scale affected position?
    // =========================================================================

    point {
        pos: 100, 450

        // Grid lines every 50px
        graphics(
            line(#555, 1, 0, 0, 400, 0);
            line(#555, 1, 0, 50, 400, 50);
            line(#555, 1, 0, 100, 400, 100);
            line(#555, 1, 0, 150, 400, 150);
            line(#555, 1, 50, 0, 50, 150);
            line(#555, 1, 100, 0, 100, 150);
            line(#555, 1, 150, 0, 150, 150);
            line(#555, 1, 200, 0, 200, 150);
            line(#555, 1, 250, 0, 250, 150);
            line(#555, 1, 300, 0, 300, 150);
        );

        // Magenta box: scale 3, position (50, 25)
        // ACTUAL position: (50, 25) - just bigger
        @scale(3) bitmap(generated(color(10, 10, #F0F))):50,25;

        // Ghost outline where it WOULD be if position was scaled (150, 75)
        graphics(
            rect(#F0F, 1, 30, 30): 150, 75  // outline at (150, 75)
        );

        // Labels
        text(m3x6, "(50,25)", #F0F, left, 100):50,60;
        text(m3x6, "(150,75) - if pos was scaled", #888, left, 200):150,110;
    }

    text(m3x6, "TEST 3: Magenta at 50,25 with scale 3. Outline shows where it WOULD be if position was scaled", white, left, 800):100,620;

    // =========================================================================
    // TEST 4: Property syntax vs inline syntax
    // =========================================================================

    point {
        pos: 600, 280

        graphics(
            line(#FF0, 1, 0, 0, 200, 0);
            line(#FF0, 1, 0, 0, 0, 100);
        );

        // Inline @scale syntax
        @scale(2) bitmap(generated(color(15, 15, #F80))):30,20;

        // Property syntax - should be identical
        bitmap(generated(color(15, 15, #08F))) {
            scale: 2
            pos: 30, 50
        }

        text(m3x6, "@scale(2) at 30,20 (orange)", #F80, left, 200):0,90;
        text(m3x6, "scale:2 at 30,50 (blue)", #08F, left, 200):0,105;
    }

    text(m3x6, "TEST 4: Inline @scale vs property syntax - both work the same", white, left, 500):600,400;

    // Legend
    text(m3x6, "Yellow crosshairs mark coordinate origins. Scale only affects element size, NOT position.", #FF0, left, 800):100,680;
}
